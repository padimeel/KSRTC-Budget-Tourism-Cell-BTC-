<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management | KSRTC Official</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f0fdf4; }
        .emerald-gradient { background: linear-gradient(135deg, #059669 0%, #064e3b 100%); }
        .animate-modal-pop { animation: modalPop 0.3s ease-out; }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="pt-24 pb-12">

    {% include "components/hotelnavbar.html" %}

    <div class="max-w-6xl mx-auto px-4 space-y-10">
        
        {% if not hotel %}
        <div id="add-section" class="bg-white rounded-3xl shadow-xl shadow-emerald-100 border border-emerald-100 overflow-hidden">
            <div class="emerald-gradient px-8 py-6 text-white">
                <h2 class="text-xl font-bold flex items-center gap-3">
                    <i class="fas fa-hotel"></i> Register Your Property
                </h2>
                <p class="text-emerald-100 text-xs mt-1 uppercase tracking-widest font-semibold">Step 1: Basic Information</p>
            </div>
            
            <form id="hotelForm" class="p-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase ml-1">Hotel Name</label>
                    <input type="text" id="hotel_name" placeholder="Grand Tea Resort" class="w-full p-3 bg-emerald-50/30 border border-emerald-100 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none transition-all" required>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase ml-1">Email Address</label>
                    <input type="email" id="email" placeholder="manager@hotel.com" class="w-full p-3 bg-emerald-50/30 border border-emerald-100 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" required>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase ml-1">Phone Number</label>
                    <input type="text" id="phone_number" placeholder="+91 98765..." class="w-full p-3 bg-emerald-50/30 border border-emerald-100 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" required>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase ml-1">City</label>
                    <input type="text" id="city" placeholder="Munnar" class="w-full p-3 bg-emerald-50/30 border border-emerald-100 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" required>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase ml-1">Pincode</label>
                    <input type="text" id="pincode" placeholder="685612" class="w-full p-3 bg-emerald-50/30 border border-emerald-100 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" required>
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase ml-1">Total Rooms Available</label>
                    <input type="number" id="total_rooms" placeholder="25" class="w-full p-3 bg-emerald-50/30 border border-emerald-100 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" required>
                </div>
                <div class="md:col-span-3 space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase ml-1">Full Address</label>
                    <textarea id="address" placeholder="Near KSRTC Stand, Munnar..." class="w-full p-3 bg-emerald-50/30 border border-emerald-100 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" rows="3"></textarea>
                </div>
                <div class="md:col-span-3 flex justify-end gap-4">
                    <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white font-black px-10 py-3 rounded-xl shadow-lg transition-all active:scale-95">
                        <i class="fas fa-cloud-upload-alt mr-2"></i> Save Details
                    </button>
                </div>
            </form>
        </div>
        {% endif %}

        <div class="bg-white rounded-3xl shadow-xl shadow-emerald-100 border border-emerald-100 overflow-hidden">
            <div class="bg-emerald-900 px-8 py-5 flex justify-between items-center">
                <h2 class="text-white font-bold flex items-center gap-2">
                    <i class="fas fa-list-check"></i> Registered Hotel Profile
                </h2>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-emerald-50/50 text-emerald-900 border-b border-emerald-100">
                            <th class="p-5 font-bold text-xs uppercase">Property Name</th>
                            <th class="p-5 font-bold text-xs uppercase">Location</th>
                            <th class="p-5 font-bold text-xs uppercase">Contact Details</th>
                            <th class="p-5 font-bold text-xs uppercase text-center">Rooms</th>
                            <th class="p-5 font-bold text-xs uppercase text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-emerald-50">
                        {% if hotel %}
                        <tr class="hover:bg-emerald-50/30">
                            <td class="p-5">
                                <p class="font-bold text-emerald-950">{{ hotel.hotel_name }}</p>
                                <p class="text-[10px] text-emerald-600 uppercase font-bold">ID: {{ hotel.id }}</p>
                            </td>
                            <td class="p-5">
                                <p class="text-slate-700 font-semibold">{{ hotel.city }} - {{ hotel.pincode }}</p>
                                <p class="text-xs text-slate-400 mt-1">{{ hotel.address }}</p>
                            </td>
                            <td class="p-5">
                                <p class="text-xs text-slate-600">{{ hotel.email }}</p>
                                <p class="text-xs text-slate-600">{{ hotel.phone_number }}</p>
                            </td>
                            <td class="p-5 text-center">
                                <span class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-xs font-black">{{ hotel.total_rooms }}</span>
                            </td>
                            <td class="p-5">
                                <div class="flex justify-center gap-3">
                                    <button onclick="toggleUpdateModal()" class="w-9 h-9 bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white rounded-xl flex items-center justify-center transition-all">
                                        <i class="fas fa-pen-to-square"></i>
                                    </button>
                                    <button onclick="handleDelete()" class="w-9 h-9 bg-red-50 text-red-600 hover:bg-red-600 hover:text-white rounded-xl flex items-center justify-center transition-all">
                                        <i class="fas fa-trash-can"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="5" class="p-16 text-center text-slate-400 italic">No property registered yet.</td></tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="updateModal" class="hidden fixed inset-0 bg-emerald-950/40 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] w-full max-w-4xl overflow-hidden shadow-2xl animate-modal-pop">
            <div class="emerald-gradient p-6 text-white flex justify-between items-center">
                <h3 class="font-bold text-lg flex items-center gap-3"><i class="fas fa-edit"></i> Update Property Details</h3>
                <button onclick="toggleUpdateModal()" class="w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>
            
            <form id="updateForm" class="p-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase">Hotel Name</label>
                    <input type="text" id="upd_hotel_name" value="{{ hotel.hotel_name }}" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase">Email</label>
                    <input type="email" id="upd_email" value="{{ hotel.email }}" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase">Phone</label>
                    <input type="text" id="upd_phone" value="{{ hotel.phone_number }}" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase">City</label>
                    <input type="text" id="upd_city" value="{{ hotel.city }}" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase">Pincode</label>
                    <input type="text" id="upd_pincode" value="{{ hotel.pincode }}" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase">Total Rooms</label>
                    <input type="number" id="upd_rooms" value="{{ hotel.total_rooms }}" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <div class="md:col-span-3 space-y-1">
                    <label class="text-[10px] font-bold text-emerald-800 uppercase">Full Address</label>
                    <textarea id="upd_address" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none" rows="2">{{ hotel.address }}</textarea>
                </div>
                
                <div class="md:col-span-3 pt-4 flex gap-3">
                    <button type="button" onclick="toggleUpdateModal()" class="flex-1 py-3 font-bold text-slate-500 bg-slate-100 rounded-xl">Cancel</button>
                    <button type="submit" class="flex-[2] py-3 font-black text-white bg-emerald-600 rounded-xl shadow-lg transition-all">APPLY UPDATES</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const axiosConfig = { headers: { 'X-CSRFToken': '{{ csrf_token }}' } };

        // CREATE
        document.getElementById('hotelForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                hotel_name: document.getElementById('hotel_name').value,
                email: document.getElementById('email').value,
                phone_number: document.getElementById('phone_number').value,
                city: document.getElementById('city').value,
                pincode: document.getElementById('pincode').value,
                total_rooms: parseInt(document.getElementById('total_rooms').value),
                address: document.getElementById('address').value,
                description: "KSRTC Partner", amenities: [], hotel_banner_images: [], room_images: []
            };
            try {
                await axios.post(window.location.href, data, axiosConfig);
                location.reload();
            } catch (err) { alert("Error: " + err.response?.data?.error); }
        });

        // UPDATE (Handles all fields)
        document.getElementById('updateForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                hotel_name: document.getElementById('upd_hotel_name').value,
                email: document.getElementById('upd_email').value,
                phone_number: document.getElementById('upd_phone').value,
                city: document.getElementById('upd_city').value,
                pincode: document.getElementById('upd_pincode').value,
                total_rooms: parseInt(document.getElementById('upd_rooms').value),
                address: document.getElementById('upd_address').value
            };
            try {
                await axios.put(window.location.href, data, axiosConfig);
                location.reload();
            } catch (err) { alert("Update failed."); }
        });

        // DELETE
        async function handleDelete() {
            if(confirm("Delete this property?")) {
                try { await axios.delete(window.location.href, axiosConfig); location.reload(); }
                catch (err) { alert("Delete failed."); }
            }
        }

        function toggleUpdateModal() { document.getElementById('updateModal').classList.toggle('hidden'); }
    </script>
</body>
</html>