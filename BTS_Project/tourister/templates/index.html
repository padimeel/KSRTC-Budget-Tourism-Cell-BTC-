{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>KSRTC BTC — Explore Kerala</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
  </head>
  <body class="font-sans bg-gray-50 text-gray-800">
    {% include 'components/navbar.html' %}

    <section class="relative">
      <img
        src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=2000&auto=format&fit=crop&ixlib=rb-4.0.3&s=b62b70b9a5c2b6b3d6542ad8e85f0a8e"
        alt="Kerala hills and backwater"
        class="w-full h-[68vh] object-cover brightness-90"
      />
      <div
        class="absolute inset-0 bg-gradient-to-b from-black/30 via-black/20 to-black/50"
      ></div>

      <div class="absolute inset-0 flex items-center justify-center px-6">
        <div class="max-w-5xl w-full text-center">
          <h2
            class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-white leading-tight drop-shadow-lg"
          >
            Discover Kerala — Hills, Backwaters & Beaches
          </h2>
          <p class="mt-4 text-white/90 max-w-2xl mx-auto text-lg md:text-xl">
            Handpicked budget-friendly tours by KSRTC Budget Tourism Cell.
            Comfortable buses, controlled costs, unforgettable memories.
          </p>
        </div>
      </div>
    </section>

    <section class="max-w-7xl mx-auto px-6 mt-14">
      <h3 class="text-2xl md:text-3xl font-extrabold text-rose-700 text-center">
        Explore Holidays By Theme
      </h3>
      <p class="text-gray-600 text-center mt-2">
        Find your perfect getaway, tailored to your interests.
      </p>

      <div class="mt-8 flex flex-wrap items-center justify-center gap-8">
        <div class="group flex flex-col items-center w-44 transition-all duration-300 hover:scale-105">
          <div class="w-36 h-36 rounded-full backdrop-blur-lg bg-white/30 flex items-center justify-center border border-rose-100 shadow-sm group-hover:shadow-lg group-hover:shadow-rose-300 transition-all duration-300">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" class="w-12 transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-1" alt="family" />
          </div>
          <p class="mt-3 font-semibold text-gray-800 group-hover:text-rose-700 transition-colors duration-300">Family Retreat</p>
          <p class="text-sm text-gray-500 group-hover:text-rose-500 transition-colors duration-300">Explore Now</p>
        </div>
        <div class="group flex flex-col items-center w-44 transition-all duration-300 hover:scale-105">
          <div class="w-36 h-36 rounded-full backdrop-blur-lg bg-white/30 flex items-center justify-center border border-rose-100 shadow-sm group-hover:shadow-lg group-hover:shadow-rose-300 transition-all duration-300">
            <img src="https://cdn-icons-png.flaticon.com/512/168/168366.png" class="w-12 transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-1" alt="luxury" />
          </div>
          <p class="mt-3 font-semibold text-gray-800 group-hover:text-rose-700 transition-colors duration-300">Luxury</p>
          <p class="text-sm text-gray-500 group-hover:text-rose-500 transition-colors duration-300">Explore Now</p>
        </div>
        <div class="group flex flex-col items-center w-44 transition-all duration-300 hover:scale-105">
          <div class="w-36 h-36 rounded-full backdrop-blur-lg bg-white/30 flex items-center justify-center border border-rose-100 shadow-sm group-hover:shadow-lg group-hover:shadow-rose-300 transition-all duration-300">
            <img src="https://cdn-icons-png.flaticon.com/512/3075/3075977.png" class="w-12 transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-1" alt="weekend" />
          </div>
          <p class="mt-3 font-semibold text-gray-800 group-hover:text-rose-700 transition-colors duration-300">Weekend</p>
          <p class="text-sm text-gray-500 group-hover:text-rose-500 transition-colors duration-300">Explore Now</p>
        </div>
        <div class="group flex flex-col items-center w-44 transition-all duration-300 hover:scale-105">
          <div class="w-36 h-36 rounded-full backdrop-blur-lg bg-white/30 flex items-center justify-center border border-rose-100 shadow-sm group-hover:shadow-lg group-hover:shadow-rose-300 transition-all duration-300">
            <img src="https://cdn-icons-png.flaticon.com/512/711/711769.png" class="w-12 transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-1" alt="honeymoon" />
          </div>
          <p class="mt-3 font-semibold text-gray-800 group-hover:text-rose-700 transition-colors duration-300">Honeymoon</p>
          <p class="text-sm text-gray-500 group-hover:text-rose-500 transition-colors duration-300">Explore Now</p>
        </div>
        <div class="group flex flex-col items-center w-44 transition-all duration-300 hover:scale-105">
          <div class="w-36 h-36 rounded-full backdrop-blur-lg bg-white/30 flex items-center justify-center border border-rose-100 shadow-sm group-hover:shadow-lg group-hover:shadow-rose-300 transition-all duration-300">
            <img src="https://cdn-icons-png.flaticon.com/512/921/921490.png" class="w-12 transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-1" alt="adventure" />
          </div>
          <p class="mt-3 font-semibold text-gray-800 group-hover:text-rose-700 transition-colors duration-300">Adventure</p>
          <p class="text-sm text-gray-500 group-hover:text-rose-500 transition-colors duration-300">Explore Now</p>
        </div>
      </div>
    </section>

    <section class="max-w-7xl mx-auto px-6 mt-16">
      <div class="flex items-center justify-between flex-wrap gap-4">
        <div>
          <h3 class="text-3xl font-extrabold text-rose-700">Handpicked Holiday Packages</h3>
          <p class="text-gray-600 mt-1">Indulge in unforgettable experiences across Kerala.</p>
        </div>
      </div>

      <div id="packagesContainer" class="mt-10 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8"></div>

      <div class="text-center mb-8 mt-12">
        <h1 class="text-3xl font-bold mb-2">What Our Travellers Say</h1>
        <h6 class="text-gray-500">Real Experiences From Happy KSRTC BTC Passengers</h6>
      </div>

      <div id="reviewsGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>

      <div class="text-center mt-6">
        <button id="loadBtn" class="px-6 py-2 border border-rose-600 text-rose-600 rounded-3xl">View More</button>
        <button id="lessBtn" class="px-6 py-2 border border-rose-600 text-rose-600 rounded-3xl">View Less</button>
      </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // Fetch Packages
      axios.get("http://127.0.0.1:8000/tourister/index/", {
        headers: { "Accept": "application/json" }
      })
      .then((response) => {
        const data = response.data.packages; 
        const container = document.getElementById("packagesContainer");
        let packageHtml = "";

        data.forEach((item) => {
          packageHtml += `
            <article class="relative group rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2">
              <img src="${item.image1}" alt="${item.package_name}" class="w-full h-64 object-cover group-hover:scale-110 transition-transform duration-500">
              <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>
              <div class="absolute bottom-0 p-5 text-white w-full">
                <h4 class="text-xl font-bold mb-1">${item.package_name}</h4>
                <span class="text-rose-400 font-bold text-lg">₹${item.price}</span>
                <p class="text-gray-200 text-sm mt-1 line-clamp-2 leading-relaxed">
                  ${item.package_overview}
                </p>
                <button onclick="viewPackage(${item.id})"
                  class="mt-4 bg-rose-600 hover:bg-rose-700 px-5 py-2 rounded-full text-sm font-medium transition duration-300 inline-flex items-center">
                  Explore Now
                </button>
              </div>
            </article>
          `;
        });
        container.innerHTML = packageHtml;
      })
      .catch((error) => console.error("Error fetching packages:", error));

      function viewPackage(id) {
        window.location.href = `/tourister/packagedetails-template/${id}/`;
      }

      // Fetch Reviews
      window.onload = function () {
        const reviewsGrid = document.getElementById("reviewsGrid");
        const loadBtn = document.getElementById("loadBtn");
        const lessBtn = document.getElementById("lessBtn");

        lessBtn.classList.add("hidden");
        loadBtn.classList.add("hidden");

        axios.get("http://127.0.0.1:8000/tourister/index/") 
        .then((response) => {
          const reviews = response.data.reviews; 

          if (!reviews || reviews.length === 0) {
            reviewsGrid.innerHTML = "<p class='text-gray-500 text-center col-span-full py-10 font-bold'>No reviews yet.</p>";
            return;
          }

          let html = "";
          reviews.forEach((item, index) => {
            let stars = "";
            for (let i = 1; i <= 5; i++) {
              stars += `<i class="fa-solid fa-star ${i <= item.rating ? "text-yellow-400" : "text-gray-200"}"></i>`;
            }
            const hiddenClass = index >= 3 ? "hidden extraReview" : "";
            html += `
              <article class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 transition-all hover:shadow-md ${hiddenClass}">
                <h2 class="text-sm font-black text-slate-800 mb-1 uppercase tracking-tight">
                    ${item.user?.username || "Guest User"}
                </h2>
                <div class="flex gap-1 mb-3 text-[10px]">${stars}</div>
                <p class="text-slate-600 text-sm italic leading-relaxed">
                    "${item.review || "No review provided"}"
                </p>
              </article>
            `;
          });

          reviewsGrid.innerHTML = html;
          const extraReviews = document.querySelectorAll(".extraReview");

          if (reviews.length > 3) {
            loadBtn.classList.remove("hidden");
          }

          loadBtn.onclick = () => {
            extraReviews.forEach((card) => card.classList.remove("hidden"));
            loadBtn.classList.add("hidden");
            lessBtn.classList.remove("hidden");
          };

          lessBtn.onclick = () => {
            extraReviews.forEach((card) => card.classList.add("hidden"));
            lessBtn.classList.add("hidden");
            loadBtn.classList.remove("hidden");
            reviewsGrid.scrollIntoView({ behavior: 'smooth' });
          };
        })
        .catch((error) => {
          console.error("Error fetching data:", error);
          reviewsGrid.innerHTML = "<p class='text-rose-500 font-bold text-center col-span-full'>Failed to load reviews.</p>";
        });
      };
    </script>

    {% include 'components/footer.html' %}
  </body>
</html>