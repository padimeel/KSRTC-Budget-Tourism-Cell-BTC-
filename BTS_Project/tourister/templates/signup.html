<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Signup | KSRTC BTC</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>

  <body class="bg-gradient-to-br from-rose-50 to-amber-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl bg-white rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden">
      <!-- LEFT -->
      <div class="w-full md:w-1/2 bg-gradient-to-b from-rose-600 to-rose-800 text-white flex flex-col justify-center items-center p-10">
        <img src="https://cdn-icons-png.flaticon.com/512/747/747376.png" alt="KSRTC" class="w-20 mb-4" />
        <h2 class="text-3xl font-bold mb-2 text-center">KSRTC Budget Tourism Cell</h2>
        <p class="text-center text-rose-100 text-sm">Explore Kerala at affordable prices. Book your dream trip now!</p>
      </div>

      <!-- RIGHT -->
      <div class="w-full md:w-1/2 p-8 flex flex-col justify-center">
        <h2 class="text-3xl font-bold text-rose-700 mb-2 text-center md:text-left">Create Your Account</h2>
        <p class="text-gray-600 mb-6 text-center md:text-left">Sign up to book and manage your KSRTC tours.</p>

        <form id="signupForm" class="space-y-5" novalidate>
          <div>
            <label class="text-sm font-semibold text-gray-600">Username</label>
            <input id="username" type="text" placeholder="Enter username" required class="w-full border rounded-lg px-4 py-2 mt-1 focus:ring-2 focus:ring-[#b70e32]" />
            <p id="usernameMsg" class="text-sm mt-1"></p>
          </div>

          <div>
            <label class="text-sm font-semibold text-gray-600">Email Address</label>
            <input id="email" type="email" placeholder="example@gmail.com" required class="w-full border rounded-lg px-4 py-2 mt-1 focus:ring-2 focus:ring-rose-600" />
            <p id="emailMsg" class="text-sm mt-1"></p>
          </div>

          <div>
            <label class="text-sm font-semibold text-gray-600">Phone Number</label>
            <input id="phone_number" type="tel" placeholder="9876543210" required class="w-full border rounded-lg px-4 py-2 mt-1 focus:ring-2 focus:ring-rose-600" />
            <p id="phoneMsg" class="text-sm mt-1"></p>
          </div>

          <div>
            <label class="text-sm font-semibold text-gray-600">Password</label>
            <input id="password" type="password" placeholder="Enter password" required class="w-full border rounded-lg px-4 py-2 mt-1 focus:ring-2 focus:ring-rose-600" />
            <p id="passwordMsg" class="text-sm mt-1"></p>
          </div>

          <button type="submit" class="w-full bg-rose-600 hover:bg-rose-700 text-white py-2 rounded-lg font-semibold shadow-md transition-all">SIGN UP</button>

          <p class="text-center text-gray-600 text-sm mt-6">
            Already have an account?
            <a href="{% url 'tourister:login' %}" class="text-rose-600 font-semibold hover:underline">Sign in</a>
          </p>
        </form>
      </div>
    </div>

  <!-- ... Keep the entire HTML and form as it is ... -->

<script>
  const form = document.getElementById("signupForm");

  function showError(id, msg) {
    const el = document.getElementById(id);
    el.innerText = msg;
    el.style.color = "red";
  }

  function showSuccess(id, msg) {
    const el = document.getElementById(id);
    el.innerText = msg;
    el.style.color = "green";
  }

  // Clear messages when typing
  document.querySelectorAll("input").forEach((input) => {
    input.addEventListener("input", () => {
      const msg = document.getElementById(input.id + "Msg");
      if (msg) msg.innerText = "";
    });
  });

  function validateForm() {
    let isValid = true;

    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const phone = document.getElementById("phone_number").value.trim();
    const password = document.getElementById("password").value.trim();

    if (username.length < 3) {
      showError("usernameMsg", "Username must be at least 3 characters");
      isValid = false;
    } else showSuccess("usernameMsg", "Looks Good");

    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
      showError("emailMsg", "Enter a valid email");
      isValid = false;
    } else showSuccess("emailMsg", "Valid Email");

    const phonePattern = /^[0-9]{10}$/;
    if (!phonePattern.test(phone)) {
      showError("phoneMsg", "Phone must be 10 digits");
      isValid = false;
    } else showSuccess("phoneMsg", "Valid Phone");

    if (password.length < 6) {
      showError("passwordMsg", "Password must be 6+ characters");
      isValid = false;
    } else showSuccess("passwordMsg", "Strong Password");

    return isValid;
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!validateForm()) return;

    const data = {
      username: document.getElementById("username").value,
      email: document.getElementById("email").value,
      phone_number: document.getElementById("phone_number").value,
      password: document.getElementById("password").value,
    };

    try {
      const res = await axios.post(
        "http://127.0.0.1:8000/tourister/signup/",
        data,
        {
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
        }
      );

      alert("✔ " + res.data.message);
      form.reset();

      // ✅ Correct redirect after signup
      setTimeout(() => {
        window.location.href = "{% url 'tourister:index' %}";
      }, 800);

    } catch (err) {
      if (err.response?.data) {
        // Flatten error messages in case serializer returns list
        const messages = Object.values(err.response.data).flat().join("\n");
        alert("Signup Failed:\n" + messages);
      } else {
        alert("Something went wrong. Please try again.");
      }
    }
  });
</script>

  </body>
</html>
