<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSRTC Depot Manager Login</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-amber-50 min-h-screen flex items-center justify-center p-6 font-sans">

    <div class="max-w-4xl w-full flex bg-white rounded-3xl shadow-2xl overflow-hidden border border-amber-100 mt-15">
        
        <div class="hidden md:flex md:w-1/2 bg-slate-900 p-12 flex-col justify-between text-white relative">
            <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-500/10 rounded-full -mr-16 -mt-16"></div>
            
            <div class="relative z-10">
                <div class="text-2xl font-black tracking-tighter italic flex items-center gap-3">
                    <div class="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center text-slate-900 shadow-lg shadow-yellow-500/20">
                        <i class="fas fa-bus-alt"></i>
                    </div>
                    <span>KSRTC <span class="text-yellow-500">DEPOT</span></span>
                </div>
                
                <h2 class="text-4xl font-extrabold mt-16 leading-tight uppercase tracking-tighter">
                    Manager <br><span class="text-yellow-500">Access Portal</span>
                </h2>
                
                <p class="text-slate-400 mt-6 text-sm leading-relaxed">
                    Secure gateway for station managers to oversee budget tourism operations and schedules.
                </p>
                
                <div class="mt-12 space-y-5">
                    <div class="flex items-center gap-4 group">
                        <div class="w-8 h-8 rounded-full border border-slate-700 flex items-center justify-center group-hover:border-yellow-500 transition-colors">
                            <i class="fas fa-map-location-dot text-yellow-500 text-xs"></i>
                        </div>
                        <span class="text-sm font-semibold text-slate-300">Manage Bus & Route Itineraries</span>
                    </div>
                </div>
            </div>

            <div class="relative z-10 text-[10px] text-slate-500 font-bold uppercase tracking-[0.3em]">
                &copy; 2025 KSRTC Tourism Authority
            </div>
        </div>

        <div class="w-full md:w-1/2 p-10 md:p-14 bg-white">
            <div class="mb-12 text-center md:text-left">
                <h3 class="text-3xl font-black text-slate-800 tracking-tight">Sign In</h3>
                <div class="h-1.5 w-12 bg-yellow-500 mt-2 rounded-full"></div>
            </div>

            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-xs font-black text-slate-500 uppercase tracking-widest mb-2.5 ml-1">Depot ID / Username</label>
                    <div class="relative group">
                        <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-400 group-focus-within:text-yellow-600 transition-colors">
                            <i class="fas fa-user-tie"></i>
                        </span>
                        <input type="text" id="username" name="username" required
                            class="w-full pl-11 pr-4 py-4 rounded-2xl border border-slate-100 bg-slate-50 focus:bg-white focus:border-yellow-500 focus:ring-4 focus:ring-yellow-500/10 outline-none transition-all placeholder:text-slate-400 text-sm font-bold"
                            placeholder="manager_admin">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-black text-slate-500 uppercase tracking-widest mb-2.5 ml-1">Security Key</label>
                    <div class="relative group">
                        <span class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-400 group-focus-within:text-yellow-600 transition-colors">
                            <i class="fas fa-key"></i>
                        </span>
                        <input type="password" id="password" name="password" required
                            class="w-full pl-11 pr-4 py-4 rounded-2xl border border-slate-100 bg-slate-50 focus:bg-white focus:border-yellow-500 focus:ring-4 focus:ring-yellow-500/10 outline-none transition-all placeholder:text-slate-400 text-sm font-bold"
                            placeholder="••••••••">
                    </div>
                </div>

                <div id="errorBox" class="hidden flex items-center gap-3 text-amber-800 text-xs font-bold bg-amber-50 p-4 rounded-2xl border border-amber-200 animate-slide-up">
                    <i class="fas fa-circle-exclamation text-amber-600"></i>
                    <span id="errorMessage">Unauthorized access attempt.</span>
                </div>

                <button type="submit" id="loginBtn"
                    class="w-full bg-slate-900 hover:bg-slate-800 text-yellow-500 font-black py-4.5 rounded-2xl shadow-xl shadow-slate-200 transition-all flex items-center justify-center gap-3 active:scale-[0.98] group">
                    <span class="tracking-widest uppercase">Verify & Enter</span>
                    <i class="fas fa-arrow-right-long group-hover:translate-x-1 transition-transform"></i>
                </button>
            </form>
        </div>
    </div>

    <script>
        axios.defaults.withCredentials = true;

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const errorBox = document.getElementById('errorBox');
            const errorMessage = document.getElementById('errorMessage');

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            errorBox.classList.add('hidden');

            try {
                const response = await axios.post('http://127.0.0.1:8000/depot/login/', {
                    username: document.getElementById('username').value,
                    password: document.getElementById('password').value
                }, {
                    headers: { 'X-CSRFToken': getCookie('csrftoken') }
                });

                if (response.status === 200) {
                    
                    localStorage.setItem('depot_access', response.data.access);
                    localStorage.setItem('depot_refresh', response.data.refresh);
                    localStorage.setItem('depot_name', response.data.depot_name);
                    
                    window.location.href = '/depot/assignpackage/'; 
                }
            } catch (err) {
                errorBox.classList.remove('hidden');
                errorMessage.innerText = err.response?.data?.error || "Login failed. Please try again.";
                btn.disabled = false;
                btn.innerHTML = '<span class="tracking-widest uppercase text-sm">Verify & Enter</span> <i class="fas fa-arrow-right-long"></i>';
            }
        });
    </script>

    <style>
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
    </style>
</body>
</html>