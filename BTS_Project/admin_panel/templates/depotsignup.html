<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Depot Signup | KSRTC Budget Tourism</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
if (!localStorage.getItem('accessToken')) {
            window.location.href = '/admin_site/adminlogin-template/';
        }
    </script>

    <style>
        .bubble {
            position: absolute;
            border-radius: 50%;
            opacity: 0.35;
            animation: floatUp 12s infinite ease-in-out;
            background: radial-gradient(circle at center, #a855f7, #6b21a8);
        }

        @keyframes floatUp {
            0% { transform: translateY(0px) scale(1); opacity: 0.4; }
            50% { transform: translateY(-80px) scale(1.2); opacity: 0.25; }
            100% { transform: translateY(0px) scale(1); opacity: 0.4; }
        }

        #toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(to right, #9333ea, #6b21a8);
            color: white;
            padding: 14px 22px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.4s ease;
            z-index: 9999;
            font-size: 15px;
            font-weight: 600;
        }

        #toast.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body class="bg-purple-100 min-h-screen">
    {% include "navbar.html" %}

    <div id="toast"></div>

    <div class="relative min-h-screen flex items-start justify-center overflow-y-auto pt-28 pb-12">
        
        <div class="bubble w-40 h-40 top-20 left-10"></div>
        <div class="bubble w-28 h-28 bottom-16 right-10 animate-[floatUp_12s_ease-in-out_infinite]"></div>
        <div class="bubble w-32 h-32 top-1/2 right-[110px] animate-[floatUp_12s_ease-in-out_infinite] [animation-delay:1.5s]"></div>

        <div class="bg-white shadow-xl rounded-xl w-full max-w-md p-6 border border-purple-200 backdrop-blur-lg relative z-10 mx-4">

            <h1 class="text-2xl font-bold text-center text-purple-700 mb-1">
                KSRTC Budget Tourism
            </h1>
            <p class="text-center text-purple-500 font-medium mb-5">
                Depot Manager Signup
            </p>

            <form id="signupForm" class="space-y-4">
                {% csrf_token %} 
                <div>
                    <label class="block text-purple-700 font-semibold mb-1 text-sm">Username</label>
                    <input type="text" id="username" required minlength="3"
                        placeholder="Enter username"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-400 outline-none transition-all text-sm" />
                </div>

                <div>
                    <label class="block text-purple-700 font-semibold mb-1 text-sm">Email</label>
                    <input type="email" id="email" required
                        placeholder="Enter email"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-400 outline-none transition-all text-sm" />
                </div>

                <div>
                    <label class="block text-purple-700 font-semibold mb-1 text-sm">Password</label>
                    <input type="password" id="password" required minlength="6"
                        placeholder="Enter password"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-400 outline-none transition-all text-sm" />
                </div>

                <div>
                    <label class="block text-purple-700 font-semibold mb-1 text-sm">Depot Name</label>
                    <input type="text" id="depot_name" required
                        placeholder="KSRTC Munnar Depot"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-400 outline-none transition-all text-sm" />
                </div>

                <button type="submit" id="submitBtn"
                    class="w-full bg-gradient-to-r from-purple-600 to-purple-800 text-white py-3 rounded-lg text-md font-semibold hover:opacity-90 transition active:scale-[0.98] mt-2 shadow-lg">
                    Create Depot Account
                </button>

            </form>
        </div>
    </div>

    <script>
        
const token = localStorage.getItem("accessToken");


function showToast(message, type = "success") {
    const toast = document.getElementById("toast");
    toast.innerText = message;
    
    toast.style.background = type === "error"
        ? "linear-gradient(to right, #dc2626, #b91c1c)" 
        : "linear-gradient(to right, #9333ea, #6b21a8)"; 
    
    toast.classList.add("show");
    
    setTimeout(() => { 
        toast.classList.remove("show"); 
    }, 2500);
}


document.getElementById("signupForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    
    const btn = document.getElementById("submitBtn");
    btn.disabled = true;
    btn.innerText = "Creating Account...";

    const data = {
        username: document.getElementById("username").value.trim(),
        email: document.getElementById("email").value.trim(),
        password: document.getElementById("password").value.trim(),
        depot_name: document.getElementById("depot_name").value.trim(),
        role: "depot_manager"
    };

    try {
        const response = await axios.post("/admin_site/depotsignup/", data, {
            headers: { 
                "Accept": "application/json",
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            }
        });

        showToast("Depot Account created successfully!");
        document.getElementById("signupForm").reset();

    } catch (err) {
        let errorMessage = "Failed to create account!";
        
        if (err.response) {
            if (err.response.status === 401) {
                errorMessage = "Unauthorized! Please login again.";
            } else if (err.response.data) {
                const errorData = err.response.data;
                const firstKey = Object.keys(errorData)[0];
                errorMessage = Array.isArray(errorData[firstKey]) 
                    ? errorData[firstKey][0] 
                    : errorData[firstKey];
            }
        }
        
        showToast(errorMessage, "error");
    } finally {
        btn.disabled = false;
        btn.innerText = "Create Depot Account";
    }
});
    </script>
</body>
</html>